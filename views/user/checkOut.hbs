<div class="breadcrumbs">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 col-md-6 col-12">
                <div class="breadcrumbs-content">
                    <h1 class="page-title">checkout</h1>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-12">
                <ul class="breadcrumb-nav">
                    <li><a href="index-2.html"><i class="lni lni-home"></i> Home</a></li>
                    <li><a href="index-2.html">Shop</a></li>
                    <li>checkout</li>
                </ul>
            </div>
        </div>
    </div>
</div>

 <p class="bg-white ml-5">Select Address /<span><button  onclick="showMe()" class="btn">Add New Address</button></span>
                </p>    
<section class="checkout-wrapper section m-0">
   
    <div class="container">
       
               
                  <form id="checkOutForm">
        <div class="row justify-content-center">
            <div class="col-lg-8">
              {{#each viewAddress}}

                <div class="border border-dark  mb-2" style="background-color: #f3f2ee;">
                    <label  for="">name :</label>
                    <label for="">{{this.name}}</label> <span class="float-right"><input type="radio"
                            name="address" value="{{this._id}}"> <label for="" > Select
                            Address</label></span><br>

                    <label  for="">City :</label>
                    <label  for="">{{this.city}}</label><br>
                    <label  for="">Contact Number :</label>
                    <label  for="">{{this.phone}}</label><br>
                    <label  for="">State :</label>
                    <label for="">Pin Code :</label>
                    <label  for="">{{this.post}}</label><br>
                    <label  for="">Address Type :</label>
                    <label  for="">{{this.addressType}}</label><br>


                </div>
                {{/each}}
            </div>
            <div class="col-lg-4">
                <div class="checkout-sidebar">
                    <div class="checkout-sidebar-coupon" style="background-color: #f3f2ee;">
                        <p>Appy Coupon to get discount!</p>
                        <form action="#">
                            <div class="single-form form-default">
                                <div class="form-input form">
                                    <input type="text" placeholder="Coupon Code">
                                </div>
                                <div class="button">
                                    <button class="btn">apply</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="checkout-sidebar-price-table mt-30">
                        <h5 class="title">Pricing Table</h5>
                        <div class="sub-total-price">
                            <div class="total-price">
                                <p class="value">Total Price:</p>
                                <p class="price">{{total}}</p>
                            </div>
                          
                           
                        
                        <div class="total-payable">
                            <div class="payable-price">
                                <p class="value">Subotal Price:</p>
                                <p class="price">{{total}}</p>
                            </div>
                        </div>
                            <div class="payment_methods">
                            <p>Payment Method</p>
                            <p><input type="radio" name="method" value="COD" checked>COD</p>
                            <p><input type="radio" name="method" value="RazorPay">RazorPay
                            </p>
                            <p><input type="radio" name="method" value="payPal">PayPal
                            </p>
                        </div>
                        <button class="price-table-btn button" type="submit">Continue to
                            payment</button>
                    </div>
                       
                    </div>
                    {{!-- <div class="checkout-sidebar-banner mt-30">
                        <a href="product-grids.html">
                            <img src="assets/images/banner/banner.jpg" alt="#">
                        </a>
                    </div> --}}
                </div>
            </div>
        </div>
         </form>
    </div>
    </section>
     <div id="active" style="display:none;">
        <form class="form-horizontal" method="post" action="/addNewInCheckOut" role="form" id="form">
            <fieldset>

                <!-- Form Name -->

                <!-- Text input-->
                <div class="row">
                    <div class=" col-6">
                        <input type="text" name='userId' value='{{user._id}}' hidden>
                        <div class="form-group">
                            <label class="col-sm-2 control-label text-white" for="textinput">Name</label>
                            <div class="col-sm-10">
                                <p class="error text-danger"> </p>
                                <input type="text" placeholder="Name" id="name" value="{{address.name}}" name="name"
                                    class="form-control">
                            </div>
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label text-white" for="textinput">Mobile Number</label>
                            <div class="col-sm-10">
                                <p class="error text-danger"> </p>
                                <input type="text" value="{{address.phone}}" id="phone" placeholder="Mobile Number"
                                    name='phone' class="form-control">
                            </div>
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label text-white" for="textinput">City</label>
                            <div class="col-sm-10">
                                <p class="error text-danger"> </p>
                                <input type="text" placeholder="City" id="city" value="{{address.city}}" name="city"
                                    class="form-control">
                            </div>
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label text-white" for="textinput">State</label>
                            <div class="col-sm-4">
                                <p class="error text-danger"> </p>
                                <input type="text" placeholder="State" value="{{address.state}}" id="stateche"
                                    name="state" class="form-control">
                            </div>

                            <label class="col-sm-2 control-label text-white" for="textinput">Postcode</label>
                            <div class="col-sm-4">
                                <p class="error text-danger"> </p>
                                <input type="text" placeholder="Post Code" id="post" value="{{address.post}}"
                                    name="post" class="form-control">
                            </div>
                        </div>



                        <!-- Text input-->
                        <div class="form-group "style="background-color: #f3f2ee;">
                            <label class="col-sm-2 control-label text-white" for="textinput">Address Type</label>
                            <input type="radio" name="addressType" class="ml-5" value="Home" checked><label
                                class="text-white">Home</label>
                            <input type="radio" name="addressType" class="ml-5" value="Office"><label for=""
                                class="text-white">Office</label>

                        </div>


                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="pull-right">
                                    <button type="submit" class="btn btn-primary">Add Address</button>
                                </div>
                            </div>
                        </div>

            </fieldset>
        </form>
    </div>





















    <script>


        $("#checkOutForm").submit((e) => {
            e.preventDefault()
            $.ajax({
                url: '/placeOrder',
                method: 'post',
                data: $('#checkOutForm').serialize(),

                success: (response) => {
                    alert(response.status)
                    if (response.codStatus) {
                        location.href = '/orderSuccess'
                    } else if (response.paypal) {
                        alert('Payment method is Paypal')
                        location.href = '/pay'
                    } else {
                        alert('hey')
                        RazorpayPayment(response)
                    }
                }
            })
        })
        function RazorpayPayment(order) {
            alert('reached at razorpay payment ')
            console.log("second funtion ", order)
            var options = {
                "key": "rzp_test_LmbUUpofYaXAqd", // Enter the Key ID generated from the Dashboard
                "amount": "order.amount", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "JUTA",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",

                "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response) {
                    /*      alert(response.razorpay_payment_id);
                          alert(response.razorpay_order_id);
                          alert(response.razorpay_signature)
                      console.log("verify order",response,order)*/

                    verifyPayment(response, order)
                },
                "prefill": {
                    "name": "Gaurav Kumar",
                    "email": "gaurav.kumar@example.com",
                    "contact": "9999999999"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();
        }



        function verifyPayment(payment, order) {
            alert('reached at virify payment')
            $.ajax({
                url: '/verifyPayment',
                data: {
                    payment,
                    order
                },
                method: 'post',
                success: (response) => {
                    if (response.status) {
                        location.href = '/orderSuccess'
                    }
                    else {
                        alert("payment failed")
                    }
                }
            })
        }

    </script>


    {{!-- validation --}}
    <script>
        let form = document.getElementById('form')
        let name = document.getElementById('name')
        let phone = document.getElementById('phone')
        let city = document.getElementById('city')
        let state = document.getElementById('state')
        let post = document.getElementById('post')
        let error = document.getElementsByClassName('error')

        form.addEventListener('submit', (e) => {
            if (name.value == '' || name.value == null) {
                error[0].innerHTML = "*Name Required "
                e.preventDefault()
            }
            if (phone.value.length != 10) {
                error[1].innerHTML = "* Contact number must be ten digits "
                e.preventDefault()
            }
            if (city.value == '' || city.value == null) {
                error[2].innerHTML = "*City Name Required "
                e.preventDefault()
            }
            if (state.value == '' || state.value == null) {
                error[3].innerHTML = "*State Required "
                e.preventDefault()
            }
            if (post.value == '' || post.value == null) {
                error[4].innerHTML = "*Post Required "
                e.preventDefault()rgb(255,255,255)
    </script>
    {{!-- add new address --}}
    <script>
        function showMe() {
            document.getElementById('active').style.display = 'block'
        }
    </script>